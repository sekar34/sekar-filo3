<script>
function submitOnay(){
  let rec={
    tarih:onayTarih.value,
    plaka:onayPlaka.value,
    firma:onayFirma.value,
    km:onayKm.value,
    servis:onayServis.value,
    durum:onayDurum.value,
    aciklama:onayAciklama.value,
    tutar:onayTutar.value
  };
  db.ref("onayRecords").push(rec).then(()=>loadOnay());
  onayForm.reset();
}

// Tabloyu yükle
function loadOnay(){
  db.ref("onayRecords").on("value",snap=>{
    let tb=onayTable.querySelector("tbody");tb.innerHTML="";
    snap.forEach(ch=>{
      let r=ch.val();
      tb.innerHTML+=`
        <tr>
          <td>${r.tarih}</td>
          <td>${r.plaka}</td>
          <td>${r.firma}</td>
          <td>${r.km}</td>
          <td>${r.servis}</td>
          <td>${r.durum}</td>
          <td>${r.aciklama}</td>
          <td>${r.tutar}</td>
          <td>
            <button onclick='editOnay("${ch.key}", ${JSON.stringify(r)})'>✏️ Düzenle</button>
            <button onclick='deleteOnay("${ch.key}")'>❌ Sil</button>
          </td>
        </tr>`;
    });
  });
}

// Kayıt sil
function deleteOnay(id){
  if(confirm("Bu kayıt silinsin mi?")){
    db.ref("onayRecords/"+id).remove();
  }
}

// Kayıt düzenle
function editOnay(id, rec){
  onayTarih.value = rec.tarih;
  onayPlaka.value = rec.plaka;
  onayFirma.value = rec.firma;
  onayKm.value = rec.km;
  onayServis.value = rec.servis;
  onayDurum.value = rec.durum;
  onayAciklama.value = rec.aciklama;
  onayTutar.value = rec.tutar;

  // Kaydet butonunu Güncelle moduna al
  let btn = document.querySelector("#onayForm button");
  btn.innerText = "Güncelle";
  btn.onclick = function(){
    let updated = {
      tarih:onayTarih.value,
      plaka:onayPlaka.value,
      firma:onayFirma.value,
      km:onayKm.value,
      servis:onayServis.value,
      durum:onayDurum.value,
      aciklama:onayAciklama.value,
      tutar:onayTutar.value
    };
    db.ref("onayRecords/"+id).set(updated).then(()=>{
      loadOnay();
      onayForm.reset();
      btn.innerText="Kaydet";
      btn.onclick = submitOnay;
    });
  }
}
</script>
