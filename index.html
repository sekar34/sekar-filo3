<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>AraÃ§ Teslim Sistemi</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f5; margin:0; }
    header { background:#006f3c; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; }
    .container { padding:20px; }

    /* Login SayfasÄ± Ortada */
    #authSection {
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      height:100vh;
    }
    .login-box {
      background:white; padding:30px; border-radius:10px;
      box-shadow:0 0 8px rgba(0,0,0,0.2);
      width:300px; text-align:center;
    }
    .login-box input, .login-box button {
      width:100%; padding:10px; margin:8px 0;
      border:1px solid #ccc; border-radius:5px;
    }
    .login-box button {
      background:#006f3c; color:white; cursor:pointer; border:none;
    }
    .login-box button:hover { background:#004f2a; }

    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th,td { border:1px solid #ccc; padding:6px; text-align:center; }
    th { background:#006f3c; color:white; }
    .logout { background:#900; color:white; padding:5px 10px; border:none; cursor:pointer; }
  </style>
</head>
<body>

<header id="mainHeader" style="display:none;">
  <h1>ðŸš— AraÃ§ Teslim Sistemi</h1>
  <div>
    <span id="currentUser"></span>
    <button class="logout" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
</header>

<!-- Login -->
<div id="authSection">
  <div class="login-box">
    <h2>GiriÅŸ Yap / KayÄ±t Ol</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Åžifre">
    <button onclick="login()">GiriÅŸ Yap</button>
    <button onclick="register()">KayÄ±t Ol</button>
    <p id="authError" style="color:red"></p>
  </div>
</div>

<!-- AraÃ§ Teslim -->
<div id="mainSection" class="container" style="display:none;">
  <h2>AraÃ§ Teslim KaydÄ±</h2>
  <form id="teslimForm">
    Tarih: <input type="date" name="tarih" required>
    Plaka: <input type="text" name="plaka" required>
    Model: <input type="text" name="model" required>
    Firma: <input type="text" name="firma" required>
    Teslim Alan KiÅŸi: <input type="text" name="kisi" required>
    Ä°rtibat No: <input type="text" name="irtibat" required>
    <button type="submit">Kaydet</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Tarih</th><th>Plaka</th><th>Model</th><th>Firma</th><th>KiÅŸi</th><th>Ä°rtibat</th><th>Durum</th><th>Ä°ÅŸlem</th>
      </tr>
    </thead>
    <tbody id="teslimTable"></tbody>
  </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<script>
/* === Firebase Config === */
const firebaseConfig = {
  apiKey: "SENÄ°N_API_KEYÄ°N",
  authDomain: "SENIN_PROJEN.firebaseapp.com",
  projectId: "SENIN_PROJEN",
  storageBucket: "SENIN_PROJEN.appspot.com",
  messagingSenderId: "XXXXXXXX",
  appId: "XXXXXXXX"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* === Auth === */
function register(){
  let email=document.getElementById("email").value;
  let pass=document.getElementById("password").value;
  auth.createUserWithEmailAndPassword(email,pass)
    .catch(err=>document.getElementById("authError").innerText=err.message);
}
function login(){
  let email=document.getElementById("email").value;
  let pass=document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email,pass)
    .catch(err=>document.getElementById("authError").innerText=err.message);
}
function logout(){ auth.signOut(); }

auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("authSection").style.display="none";
    document.getElementById("mainSection").style.display="block";
    document.getElementById("mainHeader").style.display="flex";
    document.getElementById("currentUser").innerText="ðŸ‘¤ "+user.email;
    loadTeslim();
  }else{
    document.getElementById("authSection").style.display="flex";
    document.getElementById("mainSection").style.display="none";
    document.getElementById("mainHeader").style.display="none";
    document.getElementById("currentUser").innerText="";
  }
});

/* === AraÃ§ Teslim === */
document.getElementById("teslimForm").onsubmit=e=>{
  e.preventDefault();
  let f=new FormData(e.target);
  let rec={
    tarih:f.get("tarih"),
    plaka:f.get("plaka").toUpperCase(),
    model:f.get("model").toUpperCase(),
    firma:f.get("firma").toUpperCase(),
    kisi:f.get("kisi").toUpperCase(),
    irtibat:f.get("irtibat"),
    durum:"Aktif",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  };
  db.collection("teslim").add(rec).then(()=>{ e.target.reset(); });
};

/* === Tablo Render === */
function loadTeslim(){
  db.collection("teslim").orderBy("createdAt","desc").onSnapshot(snap=>{
    let tb=document.getElementById("teslimTable");
    tb.innerHTML="";
    snap.forEach(doc=>{
      let r=doc.data();
      let tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${r.tarih}</td><td>${r.plaka}</td><td>${r.model}</td>
        <td>${r.firma}</td><td>${r.kisi}</td><td>${r.irtibat}</td>
        <td>${r.durum}</td>
        <td>
          ${r.durum==="Aktif" ? `<button onclick="markTeslim('${doc.id}')">Teslim Et</button>` : ""}
        </td>`;
      tb.appendChild(tr);
    });
  });
}
function markTeslim(id){
  db.collection("teslim").doc(id).update({durum:"Pasif"});
}
</script>
</body>
</html>
